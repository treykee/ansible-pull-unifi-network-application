- name: Install UniFi Network Application role
  hosts: localhost

  tasks:
    - name: Install required role
      ansible.builtin.command: ansible-galaxy role install -r roles/requirements.yml
      args:
        creates: ./roles/treykee.unifi-network

- name: Apply UniFi Network Application role
  hosts: localhost

  tasks:
    - name: Stat role path
      ansible.builtin.stat:
        path: ./roles/treykee.unifi-network
      register: role_path

    - name: Apply role
      ansible.builtin.include_role:
        name: treykee.unifi-network
      vars:
        unifi_version: 9.0.108
        unifi_fqdn: "unifi.example.com"
        unifi_admin_username: "admin"
      when: role_path.stat.exists